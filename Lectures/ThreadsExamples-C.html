<h1 id="examples-of-using-threads-in-c-programming">Examples of using Threads in C Programming</h1>
<p><em>You may not distribute/post this tutorial or the .c files without written permission from Dr. Mike Turi, ECE Dept., California State University, Fullerton</em></p>
<h2 id="examples-for-a-linux-unix-or-mac-pc">Examples for a Linux, Unix, or Mac PC</h2>
<p>Use these links to download <a href="data:application/octet-stream;base64,I2luY2x1ZGUgPHN0ZGlvLmg+CiNpbmNsdWRlIDxzdGRsaWIuaD4gLy8gRm9yIHJhbmQKI2luY2x1ZGUgPHVuaXN0ZC5oPiAvLyBGb3Igc2xlZXAKI2luY2x1ZGUgPHB0aHJlYWQuaD4KCnZvaWQgZW5nbGlzaCggdm9pZCogbnVtICkgewogIHNsZWVwKCByYW5kKCkgJSAxMCApOwogIHByaW50ZigiSGVsbG8gZnJvbSBUaHJlYWQgJWRcbiIsICooKGludCopbnVtKSApOwogIHB0aHJlYWRfZXhpdCggTlVMTCApOwp9Cgp2b2lkIGhhd2FpaWFuKCB2b2lkKiBudW0gKSB7CiAgc2xlZXAoIHJhbmQoKSAlIDEwICk7CiAgcHJpbnRmKCJBbG9oYSBmcm9tIFRocmVhZCAlZFxuIiwgKigoaW50KiludW0pICk7CiAgcHRocmVhZF9leGl0KCBOVUxMICk7Cn0KCnZvaWQgZnJlbmNoKCB2b2lkKiBudW0gKSB7CiAgc2xlZXAoIHJhbmQoKSAlIDEwICk7CiAgcHJpbnRmKCJCb25qb3VyIGZyb20gVGhyZWFkICVkXG4iLCAqKChpbnQqKW51bSkgKTsKICBwdGhyZWFkX2V4aXQoIE5VTEwgKTsKfQoKaW50IG1haW4oKSB7CiAgdGltZV90IHQ7CiAgcHRocmVhZF90IG9uZSwgdHdvLCB0aHJlZTsKICBpbnQgdGhyZWFkTnVtWzNdOwogIGludCByZXQ7CiAgCiAgc3JhbmQoKHVuc2lnbmVkKSB0aW1lKCZ0KSk7CiAgCiAgdGhyZWFkTnVtWzBdID0gMTsKICByZXQgPSBwdGhyZWFkX2NyZWF0ZSggJm9uZSwgTlVMTCwgKHZvaWQgKillbmdsaXNoLCAodm9pZCAqKSZ0aHJlYWROdW1bMF0gKTsKICBpZiggcmV0ICkgewogICAgcHJpbnRmKCJFcnJvciB3aGVuIGNyZWF0aW5nIGEgcHRocmVhZFxuIik7CiAgICByZXR1cm4gLTE7CiAgfQogIAogIHRocmVhZE51bVsxXSA9IDI7CiAgcmV0ID0gcHRocmVhZF9jcmVhdGUoICZ0d28sIE5VTEwsICh2b2lkICopaGF3YWlpYW4sICh2b2lkICopJnRocmVhZE51bVsxXSApOwogIGlmKCByZXQgKSB7CiAgICBwcmludGYoIkVycm9yIHdoZW4gY3JlYXRpbmcgYSBwdGhyZWFkXG4iKTsKICAgIHJldHVybiAtMTsKICB9CiAgCiAgdGhyZWFkTnVtWzJdID0gMzsKICByZXQgPSBwdGhyZWFkX2NyZWF0ZSggJnRocmVlLCBOVUxMLCAodm9pZCAqKWZyZW5jaCwgKHZvaWQgKikmdGhyZWFkTnVtWzJdICk7CiAgaWYoIHJldCApIHsKICAgIHByaW50ZigiRXJyb3Igd2hlbiBjcmVhdGluZyBhIHB0aHJlYWRcbiIpOwogICAgcmV0dXJuIC0xOwogIH0KICAKICBwcmludGYoIldhaXRpbmcgZm9yIHRocmVhZHMgdG8gZXhpdFxuIik7CiAgcHRocmVhZF9qb2luKCBvbmUsIE5VTEwgKTsKICBwdGhyZWFkX2pvaW4oIHR3bywgTlVMTCApOwogIHB0aHJlYWRfam9pbiggdGhyZWUsIE5VTEwgKTsKICAKICByZXR1cm4gMDsKfQo=" download="thread.c">thread.c</a> and <a href="data:application/octet-stream;base64,I2luY2x1ZGUgPHN0ZGlvLmg+CiNpbmNsdWRlIDxzdGRsaWIuaD4gLy8gRm9yIHJhbmQKI2luY2x1ZGUgPHVuaXN0ZC5oPiAvLyBGb3Igc2xlZXAKI2luY2x1ZGUgPHN0cmluZy5oPiAvLyBGb3Igc3RyY3B5CiNpbmNsdWRlIDxwdGhyZWFkLmg+CgpzdHJ1Y3QgbXNnRGF0YSB7CiAgaW50IG51bWJlcjsKICBjaGFyIG1zZ1sxMF07CiAgaW50IHdhaXRUaW1lOwp9OwoKdm9pZCBtZXNzYWdlKCB2b2lkKiBkYXRhICkgewogIHN0cnVjdCBtc2dEYXRhICpteURhdGEgPSBkYXRhOwogIHNsZWVwKCBteURhdGEtPndhaXRUaW1lICk7CiAgcHJpbnRmKCJcIiVzXCIgZnJvbSBUaHJlYWQgJWRcbiIsIG15RGF0YS0+bXNnLCBteURhdGEtPm51bWJlciApOwogIHB0aHJlYWRfZXhpdCggTlVMTCApOwp9CgppbnQgbWFpbigpIHsKICB0aW1lX3QgdDsKICBwdGhyZWFkX3Qgb25lLCB0d28sIHRocmVlOwogIHN0cnVjdCBtc2dEYXRhIGRhdGFbM107CiAgaW50IHJldDsKICAKICBzcmFuZCgodW5zaWduZWQpIHRpbWUoJnQpKTsKICAKICBkYXRhWzBdLm51bWJlciA9IDE7CiAgc3RyY3B5KCBkYXRhWzBdLm1zZywgIkhlbGxvIik7CiAgZGF0YVswXS53YWl0VGltZSA9IHJhbmQoKSAlIDEwOwogIHJldCA9IHB0aHJlYWRfY3JlYXRlKCAmb25lLCBOVUxMLCAodm9pZCAqKW1lc3NhZ2UsICh2b2lkICopJmRhdGFbMF0gKTsKICBpZiggcmV0ICkgewogICAgcHJpbnRmKCJFcnJvciB3aGVuIGNyZWF0aW5nIGEgcHRocmVhZFxuIik7CiAgICByZXR1cm4gLTE7CiAgfQogIAogIGRhdGFbMV0ubnVtYmVyID0gMjsKICBzdHJjcHkoIGRhdGFbMV0ubXNnLCAiQWxvaGEiKTsKICBkYXRhWzFdLndhaXRUaW1lID0gcmFuZCgpICUgMTA7CiAgcmV0ID0gcHRocmVhZF9jcmVhdGUoICZ0d28sIE5VTEwsICh2b2lkICopbWVzc2FnZSwgKHZvaWQgKikmZGF0YVsxXSApOwogIGlmKCByZXQgKSB7CiAgICBwcmludGYoIkVycm9yIHdoZW4gY3JlYXRpbmcgYSBwdGhyZWFkXG4iKTsKICAgIHJldHVybiAtMTsKICB9CiAgCiAgZGF0YVsyXS5udW1iZXIgPSAzOwogIHN0cmNweSggZGF0YVsyXS5tc2csICJCb25qb3VyIik7CiAgZGF0YVsyXS53YWl0VGltZSA9IHJhbmQoKSAlIDEwOwogIHJldCA9IHB0aHJlYWRfY3JlYXRlKCAmdGhyZWUsIE5VTEwsICh2b2lkICopbWVzc2FnZSwgKHZvaWQgKikmZGF0YVsyXSApOwogIGlmKCByZXQgKSB7CiAgICBwcmludGYoIkVycm9yIHdoZW4gY3JlYXRpbmcgYSBwdGhyZWFkXG4iKTsKICAgIHJldHVybiAtMTsKICB9CiAgCiAgcHJpbnRmKCJXYWl0aW5nIGZvciB0aHJlYWRzIHRvIGV4aXRcbiIpOwogIHB0aHJlYWRfam9pbiggb25lLCBOVUxMICk7CiAgcHRocmVhZF9qb2luKCB0d28sIE5VTEwgKTsKICBwdGhyZWFkX2pvaW4oIHRocmVlLCBOVUxMICk7CiAgCiAgcmV0dXJuIDA7Cn0K" download="thread-params.c">thread-params.c</a>.</p>
<p>You can directly use the code and compile it with a compiler such as <em>gcc</em>. <em>thread.c</em> is a program which creates three threads and then waits for the three threads to exit. <em>thread-params.c</em> is a program which creates three threads, but passes multiple parameters in a <code>struct</code> to each thread before waiting for the threads to exit; note, in comparison, <em>thread.c</em> just passed a single parameter to each thread it created.</p>
<h2 id="examples-for-a-windows-pc">Examples for a Windows PC</h2>
<p>Use these links to download <a href="data:application/octet-stream;base64,I2luY2x1ZGUgPHN0ZGlvLmg+DQojaW5jbHVkZSA8c3RkbGliLmg+IC8vIEZvciByYW5kDQojaW5jbHVkZSA8dGltZS5oPiAvLyBGb3IgdGltZQ0KI2luY2x1ZGUgPHdpbmRvd3MuaD4gLy8gRm9yIFNsZWVwIGFuZCBUaHJlYWRzDQoNCkRXT1JEIFdJTkFQSSBlbmdsaXNoKCBMUFZPSUQgbnVtICkgew0KICAgIFNsZWVwKDEwMDAqKHJhbmQoKSAlIDEwKSk7DQogICAgcHJpbnRmKCJIZWxsbyBmcm9tIFRocmVhZCAlZFxuIiwgKigoaW50KiludW0pKTsNCiAgICBFeGl0VGhyZWFkKDApOw0KfQ0KDQpEV09SRCBXSU5BUEkgaGF3YWlpYW4oIExQVk9JRCBudW0gKSB7DQogICAgU2xlZXAoMTAwMCAqIChyYW5kKCkgJSAxMCkpOw0KICAgIHByaW50ZigiQWxvaGEgZnJvbSBUaHJlYWQgJWRcbiIsICooKGludCopbnVtKSk7DQogICAgRXhpdFRocmVhZCgwKTsNCn0NCg0KRFdPUkQgV0lOQVBJIGZyZW5jaCggTFBWT0lEIG51bSApIHsNCiAgICBTbGVlcCgxMDAwICogKHJhbmQoKSAlIDEwKSk7DQogICAgcHJpbnRmKCJCb25qb3VyIGZyb20gVGhyZWFkICVkXG4iLCAqKChpbnQqKW51bSkpOw0KICAgIEV4aXRUaHJlYWQoMCk7DQp9DQoNCmludCBtYWluKCkgew0KICAgIHRpbWVfdCB0Ow0KICAgIEhBTkRMRSBvbmUsIHR3bywgdGhyZWU7DQogICAgaW50IHRocmVhZE51bVszXTsNCg0KICAgIHNyYW5kKCh1bnNpZ25lZCl0aW1lKCZ0KSk7DQoNCiAgICB0aHJlYWROdW1bMF0gPSAxOw0KICAgIG9uZSA9IENyZWF0ZVRocmVhZChOVUxMLCAwLCBlbmdsaXNoLCAmdGhyZWFkTnVtWzBdLCAwLCBOVUxMKTsNCiAgICBpZiggb25lID09IE5VTEwgKSB7DQogICAgICAgIHByaW50ZigiRXJyb3Igd2hlbiBjcmVhdGluZyBhIFdpbmRvd3MgdGhyZWFkXG4iKTsNCiAgICAgICAgcmV0dXJuIC0xOw0KICAgIH0NCg0KICAgIHRocmVhZE51bVsxXSA9IDI7DQogICAgdHdvID0gQ3JlYXRlVGhyZWFkKE5VTEwsIDAsIGhhd2FpaWFuLCAmdGhyZWFkTnVtWzFdLCAwLCBOVUxMKTsNCiAgICBpZiggdHdvID09IE5VTEwgKSB7DQogICAgICAgIHByaW50ZigiRXJyb3Igd2hlbiBjcmVhdGluZyBhIFdpbmRvd3MgdGhyZWFkXG4iKTsNCiAgICAgICAgcmV0dXJuIC0xOw0KICAgIH0NCg0KICAgIHRocmVhZE51bVsyXSA9IDM7DQogICAgdGhyZWUgPSBDcmVhdGVUaHJlYWQoTlVMTCwgMCwgZnJlbmNoLCAmdGhyZWFkTnVtWzJdLCAwLCBOVUxMKTsNCiAgICBpZiggdGhyZWUgPT0gTlVMTCApIHsNCiAgICAgICAgcHJpbnRmKCJFcnJvciB3aGVuIGNyZWF0aW5nIGEgV2luZG93cyB0aHJlYWRcbiIpOw0KICAgICAgICByZXR1cm4gLTE7DQogICAgfQ0KDQogICAgcHJpbnRmKCJXYWl0aW5nIGZvciB0aHJlYWRzIHRvIGV4aXRcbiIpOw0KICAgIC8vIENvdWxkIHVzZSBXYWl0Rm9yTXVsdGlwbGVPYmplY3RzKCkgaW5zdGVhZA0KICAgIFdhaXRGb3JTaW5nbGVPYmplY3QoIG9uZSwgSU5GSU5JVEUgKTsNCiAgICBXYWl0Rm9yU2luZ2xlT2JqZWN0KCB0d28sIElORklOSVRFICk7DQogICAgV2FpdEZvclNpbmdsZU9iamVjdCggdGhyZWUsIElORklOSVRFICk7DQoNCiAgICByZXR1cm4gMDsNCn0NCg==" download="WinThread.c">WinThread.c</a> and <a href="data:application/octet-stream;base64,I2luY2x1ZGUgPHN0ZGlvLmg+DQojaW5jbHVkZSA8c3RkbGliLmg+IC8vIEZvciByYW5kDQojaW5jbHVkZSA8c3RyaW5nLmg+IC8vIEZvciBzdHJjcHlfcw0KI2luY2x1ZGUgPHRpbWUuaD4gLy8gRm9yIHRpbWUNCiNpbmNsdWRlIDx3aW5kb3dzLmg+IC8vIEZvciBTbGVlcCBhbmQgVGhyZWFkcw0KDQpzdHJ1Y3QgbXNnRGF0YSB7DQogICAgaW50IG51bWJlcjsNCiAgICBjaGFyIG1zZ1sxMF07DQogICAgaW50IHdhaXRUaW1lOw0KfTsNCg0KRFdPUkQgV0lOQVBJIG1lc3NhZ2UoIExQVk9JRCBkYXRhICkgew0KICAgIHN0cnVjdCBtc2dEYXRhKiBteURhdGEgPSBkYXRhOw0KICAgIFNsZWVwKCAxMDAwKiBteURhdGEtPndhaXRUaW1lICk7DQogICAgcHJpbnRmKCJcIiVzXCIgZnJvbSBUaHJlYWQgJWRcbiIsIG15RGF0YS0+bXNnLCBteURhdGEtPm51bWJlcik7DQogICAgRXhpdFRocmVhZCgwKTsNCn0NCg0KaW50IG1haW4oKSB7DQogICAgdGltZV90IHQ7DQogICAgSEFORExFIG9uZSwgdHdvLCB0aHJlZTsNCiAgICBzdHJ1Y3QgbXNnRGF0YSBkYXRhWzNdOw0KDQogICAgc3JhbmQoKHVuc2lnbmVkKXRpbWUoJnQpKTsNCg0KICAgIGRhdGFbMF0ubnVtYmVyID0gMTsNCiAgICBzdHJjcHlfcyhkYXRhWzBdLm1zZywgMTAsICJIZWxsbyIpOw0KICAgIGRhdGFbMF0ud2FpdFRpbWUgPSByYW5kKCkgJSAxMDsNCiAgICBvbmUgPSBDcmVhdGVUaHJlYWQoTlVMTCwgMCwgbWVzc2FnZSwgJmRhdGFbMF0sIDAsIE5VTEwpOw0KICAgIGlmKCBvbmUgPT0gTlVMTCApIHsNCiAgICAgICAgcHJpbnRmKCJFcnJvciB3aGVuIGNyZWF0aW5nIGEgV2luZG93cyB0aHJlYWRcbiIpOw0KICAgICAgICByZXR1cm4gLTE7DQogICAgfQ0KDQogICAgZGF0YVsxXS5udW1iZXIgPSAyOw0KICAgIHN0cmNweV9zKGRhdGFbMV0ubXNnLCAxMCwgIkFsb2hhIik7DQogICAgZGF0YVsxXS53YWl0VGltZSA9IHJhbmQoKSAlIDEwOw0KICAgIHR3byA9IENyZWF0ZVRocmVhZChOVUxMLCAwLCBtZXNzYWdlLCAmZGF0YVsxXSwgMCwgTlVMTCk7DQogICAgaWYoIHR3byA9PSBOVUxMICkgew0KICAgICAgICBwcmludGYoIkVycm9yIHdoZW4gY3JlYXRpbmcgYSBXaW5kb3dzIHRocmVhZFxuIik7DQogICAgICAgIHJldHVybiAtMTsNCiAgICB9DQoNCiAgICBkYXRhWzJdLm51bWJlciA9IDM7DQogICAgc3RyY3B5X3MoZGF0YVsyXS5tc2csIDEwLCAiQm9uam91ciIpOw0KICAgIGRhdGFbMl0ud2FpdFRpbWUgPSByYW5kKCkgJSAxMDsNCiAgICB0aHJlZSA9IENyZWF0ZVRocmVhZChOVUxMLCAwLCBtZXNzYWdlLCAmZGF0YVsyXSwgMCwgTlVMTCk7DQogICAgaWYoIHRocmVlID09IE5VTEwgKSB7DQogICAgICAgIHByaW50ZigiRXJyb3Igd2hlbiBjcmVhdGluZyBhIFdpbmRvd3MgdGhyZWFkXG4iKTsNCiAgICAgICAgcmV0dXJuIC0xOw0KICAgIH0NCg0KICAgIHByaW50ZigiV2FpdGluZyBmb3IgdGhyZWFkcyB0byBleGl0XG4iKTsNCiAgICAvLyBDb3VsZCB1c2UgV2FpdEZvck11bHRpcGxlT2JqZWN0cygpIGluc3RlYWQNCiAgICBXYWl0Rm9yU2luZ2xlT2JqZWN0KCBvbmUsIElORklOSVRFICk7DQogICAgV2FpdEZvclNpbmdsZU9iamVjdCggdHdvLCBJTkZJTklURSApOw0KICAgIFdhaXRGb3JTaW5nbGVPYmplY3QoIHRocmVlLCBJTkZJTklURSApOw0KDQogICAgcmV0dXJuIDA7DQp9DQo=" download="WinThreadParams.c">WinThreadParams.c</a>.</p>
<p>You can directly use this code. You should be able to use this code in any Windows development environment; I have tested this using Microsoft Visual Studio Community Edition 2019 with support to build desktop C/C++ applications. You can make a new project for each program using a <em>“Console App”</em> template; you will need to create a “.c” file and delete the “.cpp” file that is provided by default.</p>
<p>You should be able to build each project and you can try running the programs in debug mode. <em>WinThread.c</em> is is a program which creates three threads and then waits for the three threads to exit. <em>WinThreadParams.c</em> is a program which creates three threads, but passes multiple parameters in a <code>struct</code> to each thread before waiting for the threads to exit; note, in comparison, <em>WinThread.c</em> just passed a single parameter to each thread it created.</p>
