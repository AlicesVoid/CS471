<h1 id="a-brief-tutorial-of-socket-programming-in-c">A Brief Tutorial of Socket Programming in C</h1>
<p><em>You may not distribute/post this tutorial or the .c files without written permission from Dr. Mike Turi, ECE Dept., California State University, Fullerton</em></p>
<p>I highly recommend reading <a href="https://book.systemsapproach.org/foundation/software.html">section 1.4 of Computer Networks: A Systems Approach</a> by Larry L. Peterson and Bruce S. Davie.</p>
<h1 id="how-to-run-the-client-and-server-from-computer-networks-a-systems-approach">How to Run the Client and Server from <em>Computer Networks: A Systems Approach</em></h1>
<p>The C code from <a href="https://book.systemsapproach.org/foundation/software.html#example-client-server">Computer Networks: A Systems Approach</a> is designed for Linux/Unix systems and it will also run on a Mac. However, this code will not run on a Windows PC since different libraries are required; instead run the <em>WinClient.c</em> and <em>WinServer.c</em> code from later in this tutorial.</p>
<h2 id="compiling-and-running-the-client.c-and-server.c-code-on-a-linux-unix-or-mac-pc">Compiling and Running the <em>client.c</em> and <em>server.c</em> code on a Linux, Unix, or Mac PC</h2>
<p>Use these links to download <a href="data:application/octet-stream;base64,Ly8gQ29kZSBmcm9tIHNlY3Rpb24gMS40LjIgb2YgIkNvbXB1dGVyIE5ldHdvcmtzOiBBIFN5c3RlbXMgQXBwcm9hY2giLAovLyAgIHZlcnNpb24gNi4wMmRldiwgYnkgTGFycnkgTCBQZXRlcnNvbiBhbmQgQnJ1Y2UgUy4gRGF2aWUKLy8gICBodHRwczovL2Jvb2suc3lzdGVtc2FwcHJvYWNoLm9yZy9mb3VuZGF0aW9uL3NvZnR3YXJlLmh0bWwKCiNpbmNsdWRlIDxzdGRpby5oPgojaW5jbHVkZSA8c3lzL3R5cGVzLmg+CiNpbmNsdWRlIDxzeXMvc29ja2V0Lmg+CiNpbmNsdWRlIDxuZXRpbmV0L2luLmg+CiNpbmNsdWRlIDxuZXRkYi5oPgoKI2RlZmluZSBTRVJWRVJfUE9SVCA1NDMyCiNkZWZpbmUgTUFYX0xJTkUgMjU2CgppbnQKbWFpbihpbnQgYXJnYywgY2hhciAqIGFyZ3ZbXSkKewogIEZJTEUgKmZwOwogIHN0cnVjdCBob3N0ZW50ICpocDsKICBzdHJ1Y3Qgc29ja2FkZHJfaW4gc2luOwogIGNoYXIgKmhvc3Q7CiAgY2hhciBidWZbTUFYX0xJTkVdOwogIGludCBzOwogIGludCBsZW47CgogIGlmIChhcmdjPT0yKSB7CiAgICBob3N0ID0gYXJndlsxXTsKICB9CiAgZWxzZSB7CiAgICBmcHJpbnRmKHN0ZGVyciwgInVzYWdlOiBzaW1wbGV4LXRhbGsgaG9zdFxuIik7CiAgICBleGl0KDEpOwogIH0KCiAgLyogdHJhbnNsYXRlIGhvc3QgbmFtZSBpbnRvIHBlZXIncyBJUCBhZGRyZXNzICovCiAgaHAgPSBnZXRob3N0YnluYW1lKGhvc3QpOwogIGlmICghaHApIHsKICAgIGZwcmludGYoc3RkZXJyLCAic2ltcGxleC10YWxrOiB1bmtub3duIGhvc3Q6ICVzXG4iLCBob3N0KTsKICAgIGV4aXQoMSk7CiAgfQoKICAvKiBidWlsZCBhZGRyZXNzIGRhdGEgc3RydWN0dXJlICovCiAgYnplcm8oKGNoYXIgKikmc2luLCBzaXplb2Yoc2luKSk7CiAgc2luLnNpbl9mYW1pbHkgPSBBRl9JTkVUOwogIGJjb3B5KGhwLT5oX2FkZHIsIChjaGFyICopJnNpbi5zaW5fYWRkciwgaHAtPmhfbGVuZ3RoKTsKICBzaW4uc2luX3BvcnQgPSBodG9ucyhTRVJWRVJfUE9SVCk7CgogIC8qIGFjdGl2ZSBvcGVuICovCiAgaWYgKChzID0gc29ja2V0KFBGX0lORVQsIFNPQ0tfU1RSRUFNLCAwKSkgPCAwKSB7CiAgICBwZXJyb3IoInNpbXBsZXgtdGFsazogc29ja2V0Iik7CiAgICBleGl0KDEpOwogIH0KICBpZiAoY29ubmVjdChzLCAoc3RydWN0IHNvY2thZGRyICopJnNpbiwgc2l6ZW9mKHNpbikpIDwgMCkKICB7CiAgICBwZXJyb3IoInNpbXBsZXgtdGFsazogY29ubmVjdCIpOwogICAgY2xvc2Uocyk7CiAgICBleGl0KDEpOwogIH0KICAvKiBtYWluIGxvb3A6IGdldCBhbmQgc2VuZCBsaW5lcyBvZiB0ZXh0ICovCiAgd2hpbGUgKGZnZXRzKGJ1Ziwgc2l6ZW9mKGJ1ZiksIHN0ZGluKSkgewogICAgYnVmW01BWF9MSU5FLTFdID0gJ1wwJzsKICAgIGxlbiA9IHN0cmxlbihidWYpICsgMTsKICAgIHNlbmQocywgYnVmLCBsZW4sIDApOwogIH0KfQo=" download="client.c">client.c</a> and <a href="data:application/octet-stream;base64,Ly8gQ29kZSBmcm9tIHNlY3Rpb24gMS40LjIgb2YgIkNvbXB1dGVyIE5ldHdvcmtzOiBBIFN5c3RlbXMgQXBwcm9hY2giLAovLyAgIHZlcnNpb24gNi4wMmRldiwgYnkgTGFycnkgTCBQZXRlcnNvbiBhbmQgQnJ1Y2UgUy4gRGF2aWUKLy8gICBodHRwczovL2Jvb2suc3lzdGVtc2FwcHJvYWNoLm9yZy9mb3VuZGF0aW9uL3NvZnR3YXJlLmh0bWwKCiNpbmNsdWRlIDxzdGRpby5oPgojaW5jbHVkZSA8c3lzL3R5cGVzLmg+CiNpbmNsdWRlIDxzeXMvc29ja2V0Lmg+CiNpbmNsdWRlIDxuZXRpbmV0L2luLmg+CiNpbmNsdWRlIDxuZXRkYi5oPgoKI2RlZmluZSBTRVJWRVJfUE9SVCAgNTQzMgojZGVmaW5lIE1BWF9QRU5ESU5HICA1CiNkZWZpbmUgTUFYX0xJTkUgICAgIDI1NgoKaW50Cm1haW4oKQp7CiAgc3RydWN0IHNvY2thZGRyX2luIHNpbjsKICBjaGFyIGJ1ZltNQVhfTElORV07CiAgaW50IGJ1Zl9sZW4sIGFkZHJfbGVuOwogIGludCBzLCBuZXdfczsKCiAgLyogYnVpbGQgYWRkcmVzcyBkYXRhIHN0cnVjdHVyZSAqLwogIGJ6ZXJvKChjaGFyICopJnNpbiwgc2l6ZW9mKHNpbikpOwogIHNpbi5zaW5fZmFtaWx5ID0gQUZfSU5FVDsKICBzaW4uc2luX2FkZHIuc19hZGRyID0gSU5BRERSX0FOWTsKICBzaW4uc2luX3BvcnQgPSBodG9ucyhTRVJWRVJfUE9SVCk7CgogIC8qIHNldHVwIHBhc3NpdmUgb3BlbiAqLwogIGlmICgocyA9IHNvY2tldChQRl9JTkVULCBTT0NLX1NUUkVBTSwgMCkpIDwgMCkgewogICAgcGVycm9yKCJzaW1wbGV4LXRhbGs6IHNvY2tldCIpOwogICAgZXhpdCgxKTsKICB9CiAgaWYgKChiaW5kKHMsIChzdHJ1Y3Qgc29ja2FkZHIgKikmc2luLCBzaXplb2Yoc2luKSkpIDwgMCkgewogICAgcGVycm9yKCJzaW1wbGV4LXRhbGs6IGJpbmQiKTsKICAgIGV4aXQoMSk7CiAgfQogIGxpc3RlbihzLCBNQVhfUEVORElORyk7CgogLyogd2FpdCBmb3IgY29ubmVjdGlvbiwgdGhlbiByZWNlaXZlIGFuZCBwcmludCB0ZXh0ICovCiAgd2hpbGUoMSkgewogICAgaWYgKChuZXdfcyA9IGFjY2VwdChzLCAoc3RydWN0IHNvY2thZGRyICopJnNpbiwgJmFkZHJfbGVuKSkgPCAwKSB7CiAgICAgIHBlcnJvcigic2ltcGxleC10YWxrOiBhY2NlcHQiKTsKICAgICAgZXhpdCgxKTsKICAgIH0KICAgIHdoaWxlIChidWZfbGVuID0gcmVjdihuZXdfcywgYnVmLCBzaXplb2YoYnVmKSwgMCkpCiAgICAgIGZwdXRzKGJ1Ziwgc3Rkb3V0KTsKICAgIGNsb3NlKG5ld19zKTsKICB9Cn0K" download="server.c">server.c</a>.</p>
<p>You can directly use the code from this online book and compile it with a compiler such as <em>gcc</em>; e.g., “<code>gcc client.c</code>”. This will usually produce an executable named <em>a.out</em>; if desired, this can be renamed/moved; e.g., “<code>mv a.out client</code>”.</p>
<h3 id="running-the-server-run-this-first">Running the Server (run this first)</h3>
<p>Prior to running the server, I recommend that you determine the IP address of your PC. You can use the command “<code>ifconfig -a</code>” to view information about your network interfaces. Find the network interface you are using and then you should see your IP (version 4) address after <em>“inet”</em>; remember to use this address for your client and do not use the broadcast IP address. Now, go to the directory where your executable is located and run it; e.g., “<code>./server</code>”. This program will wait until strings are sent to it from a client, then it will print the strings to the screen. Use <em>Control-C</em> to exit the program.</p>
<h3 id="running-the-client">Running the Client</h3>
<p>First, determine the IP address of the server you wish to connect to; see <em>“Running the Server”</em> above. Go to the directory where your executable is located and run it with the IP address of the server you wish to connect to as a command-line argument; e.g., “<code>./client 192.168.1.25</code>”. Then enter strings of text followed by an enter/return; each string will be printed by the server. Use <em>Control-C</em> to exit the program.</p>
<h2 id="compiling-and-running-the-winclient.c-and-winserver.c-code-on-a-windows-pc">Compiling and Running the <em>WinClient.c</em> and <em>WinServer.c</em> code on a Windows PC</h2>
<p>Use these links to download <a href="data:application/octet-stream;base64,Ly8gQ29kZSBhZGFwdGVkIGZyb20gc2VjdGlvbiAxLjQuMiBvZiAiQ29tcHV0ZXIgTmV0d29ya3M6IEEgU3lzdGVtcyBBcHByb2FjaCIsDQovLyAgIHZlcnNpb24gNi4wMmRldiwgYnkgTGFycnkgTCBQZXRlcnNvbiBhbmQgQnJ1Y2UgUy4gRGF2aWUNCi8vICAgaHR0cHM6Ly9ib29rLnN5c3RlbXNhcHByb2FjaC5vcmcvZm91bmRhdGlvbi9zb2Z0d2FyZS5odG1sDQoNCiNpbmNsdWRlIDxzdGRpby5oPg0KI2luY2x1ZGUgPHN5cy90eXBlcy5oPg0KI2luY2x1ZGUgPHdpbnNvY2syLmg+DQojaW5jbHVkZSA8d3MydGNwaXAuaD4NCg0KI3ByYWdtYSBjb21tZW50KGxpYiwgIldzMl8zMi5saWIiKQ0KDQojZGVmaW5lIFNFUlZFUl9QT1JUIDU0MzINCiNkZWZpbmUgTUFYX0xJTkUgMjU2DQoNCmludA0KbWFpbihpbnQgYXJnYywgY2hhciAqIGFyZ3ZbXSkNCnsNCiAgV1NBREFUQSB3c2FEYXRhOw0KICBTT0NLRVQgcyA9IElOVkFMSURfU09DS0VUOw0KICBzdHJ1Y3Qgc29ja2FkZHJfaW4gc2luOw0KICBjaGFyICpob3N0Ow0KICBjaGFyIGJ1ZltNQVhfTElORV07DQogIGludCBsZW47DQoNCiAgaWYgKGFyZ2M9PTIpIHsNCiAgICBob3N0ID0gYXJndlsxXTsNCiAgfQ0KICBlbHNlIHsNCiAgICBmcHJpbnRmKHN0ZGVyciwgInVzYWdlOiBzaW1wbGV4LXRhbGsgaG9zdFxuIik7DQogICAgZXhpdCgxKTsNCiAgfQ0KDQogIC8vIEluaXRpYWxpemUgV2luc29jaw0KICBpZiAoV1NBU3RhcnR1cChNQUtFV09SRCgyLCAyKSwgJndzYURhdGEpICE9IDApIHsNCiAgICBwcmludGYoIldTQVN0YXJ0dXAgZmFpbGVkXG4iKTsNCiAgICByZXR1cm4gMTsNCiAgfQ0KDQogIC8qIGJ1aWxkIGFkZHJlc3MgZGF0YSBzdHJ1Y3R1cmUgKi8NCiAgbWVtc2V0KCZzaW4sIDAsIHNpemVvZihzaW4pKTsNCiAgc2luLnNpbl9mYW1pbHkgPSBBRl9JTkVUOw0KICBpbmV0X3B0b24oQUZfSU5FVCwgaG9zdCwgJnNpbi5zaW5fYWRkci5zX2FkZHIpOw0KICBzaW4uc2luX3BvcnQgPSBodG9ucyhTRVJWRVJfUE9SVCk7DQoNCiAgLyogYWN0aXZlIG9wZW4gKi8NCiAgaWYgKChzID0gc29ja2V0KFBGX0lORVQsIFNPQ0tfU1RSRUFNLCAwKSkgPT0gSU5WQUxJRF9TT0NLRVQpIHsNCiAgICBwZXJyb3IoInNpbXBsZXgtdGFsazogc29ja2V0Iik7DQogICAgV1NBQ2xlYW51cCgpOw0KICAgIGV4aXQoMSk7DQogIH0NCiAgaWYgKGNvbm5lY3QocywgKHN0cnVjdCBzb2NrYWRkciopJnNpbiwgc2l6ZW9mKHNpbikpIDwgMCkgew0KICAgIHBlcnJvcigic2ltcGxleC10YWxrOiBjb25uZWN0Iik7DQogICAgY2xvc2Vzb2NrZXQocyk7DQogICAgV1NBQ2xlYW51cCgpOw0KICAgIGV4aXQoMSk7DQogIH0NCiAgLyogbWFpbiBsb29wOiBnZXQgYW5kIHNlbmQgbGluZXMgb2YgdGV4dCAqLw0KICB3aGlsZSAoZmdldHMoYnVmLCBzaXplb2YoYnVmKSwgc3RkaW4pKSB7DQogICAgYnVmW01BWF9MSU5FIC0gMV0gPSAnXDAnOw0KICAgIGxlbiA9IHN0cmxlbihidWYpICsgMTsNCiAgICBzZW5kKHMsIGJ1ZiwgbGVuLCAwKTsNCiAgfQ0KDQogIGNsb3Nlc29ja2V0KHMpOw0KICBXU0FDbGVhbnVwKCk7DQogIHJldHVybiAwOw0KfQ0K" download="WinClient.c">WinClient.c</a> and <a href="data:application/octet-stream;base64,Ly8gQ29kZSBhZGFwdGVkIGZyb20gc2VjdGlvbiAxLjQuMiBvZiAiQ29tcHV0ZXIgTmV0d29ya3M6IEEgU3lzdGVtcyBBcHByb2FjaCIsDQovLyAgIHZlcnNpb24gNi4wMmRldiwgYnkgTGFycnkgTCBQZXRlcnNvbiBhbmQgQnJ1Y2UgUy4gRGF2aWUNCi8vICAgaHR0cHM6Ly9ib29rLnN5c3RlbXNhcHByb2FjaC5vcmcvZm91bmRhdGlvbi9zb2Z0d2FyZS5odG1sDQoNCiNpbmNsdWRlIDxzdGRpby5oPg0KI2luY2x1ZGUgPHN5cy90eXBlcy5oPg0KI2luY2x1ZGUgPHdpbnNvY2syLmg+DQojaW5jbHVkZSA8d3MydGNwaXAuaD4NCg0KI3ByYWdtYSBjb21tZW50KGxpYiwgIldzMl8zMi5saWIiKQ0KDQojZGVmaW5lIFNFUlZFUl9QT1JUICA1NDMyDQojZGVmaW5lIE1BWF9QRU5ESU5HICA1DQojZGVmaW5lIE1BWF9MSU5FICAgICAyNTYNCg0KaW50DQptYWluKCkNCnsNCiAgV1NBREFUQSB3c2FEYXRhOw0KICBTT0NLRVQgcyA9IElOVkFMSURfU09DS0VULCBuZXdfcyA9IElOVkFMSURfU09DS0VUOw0KICBzdHJ1Y3Qgc29ja2FkZHJfaW4gc2luOw0KICBjaGFyIGJ1ZltNQVhfTElORV07DQogIGludCBidWZfbGVuLCBhZGRyX2xlbiA9IHNpemVvZihzdHJ1Y3Qgc29ja2FkZHJfaW4pOw0KDQogIC8vIEluaXRpYWxpemUgV2luc29jaw0KICBpZiAoV1NBU3RhcnR1cChNQUtFV09SRCgyLCAyKSwgJndzYURhdGEpICE9IDApIHsNCiAgICBwcmludGYoIldTQVN0YXJ0dXAgZmFpbGVkXG4iKTsNCiAgICByZXR1cm4gMTsNCiAgfQ0KDQogIC8qIGJ1aWxkIGFkZHJlc3MgZGF0YSBzdHJ1Y3R1cmUgKi8NCiAgbWVtc2V0KCZzaW4sIDAsIHNpemVvZihzaW4pKTsNCiAgc2luLnNpbl9mYW1pbHkgPSBBRl9JTkVUOw0KICBzaW4uc2luX2FkZHIuc19hZGRyID0gSU5BRERSX0FOWTsNCiAgc2luLnNpbl9wb3J0ID0gaHRvbnMoU0VSVkVSX1BPUlQpOw0KDQogIC8qIHNldHVwIHBhc3NpdmUgb3BlbiAqLw0KICBpZiAoKHMgPSBzb2NrZXQoUEZfSU5FVCwgU09DS19TVFJFQU0sIDApKSA9PSBJTlZBTElEX1NPQ0tFVCkgew0KICAgIHBlcnJvcigic2ltcGxleC10YWxrOiBzb2NrZXQiKTsNCiAgICBXU0FDbGVhbnVwKCk7DQogICAgZXhpdCgxKTsNCiAgfQ0KICBpZiAoKGJpbmQocywgKHN0cnVjdCBzb2NrYWRkciopJnNpbiwgc2l6ZW9mKHNpbikpKSA9PSBTT0NLRVRfRVJST1IpIHsNCiAgICBwZXJyb3IoInNpbXBsZXgtdGFsazogYmluZCIpOw0KICAgIGNsb3Nlc29ja2V0KHMpOw0KICAgIFdTQUNsZWFudXAoKTsNCiAgICBleGl0KDEpOw0KICB9DQogIGxpc3RlbihzLCBNQVhfUEVORElORyk7DQoNCiAvKiB3YWl0IGZvciBjb25uZWN0aW9uLCB0aGVuIHJlY2VpdmUgYW5kIHByaW50IHRleHQgKi8NCiAgd2hpbGUoMSkgew0KICAgIGlmICgobmV3X3MgPSBhY2NlcHQocywgKHN0cnVjdCBzb2NrYWRkciopJnNpbiwgJmFkZHJfbGVuKSkgPT0gSU5WQUxJRF9TT0NLRVQpIHsNCiAgICAgIHBlcnJvcigic2ltcGxleC10YWxrOiBhY2NlcHQiKTsNCiAgICAgIGNsb3Nlc29ja2V0KHMpOw0KICAgICAgV1NBQ2xlYW51cCgpOw0KICAgICAgZXhpdCgxKTsNCiAgICB9DQogICAgd2hpbGUgKGJ1Zl9sZW4gPSByZWN2KG5ld19zLCBidWYsIHNpemVvZihidWYpLCAwKSkNCiAgICAgIGZwdXRzKGJ1Ziwgc3Rkb3V0KTsNCiAgICBjbG9zZXNvY2tldChuZXdfcyk7DQogIH0NCg0KICBjbG9zZXNvY2tldChzKTsNCiAgV1NBQ2xlYW51cCgpOw0KICByZXR1cm4gMDsNCn0NCg==" download="WinServer.c">WinServer.c</a>.</p>
<p>You can directly use this code; this is adapted from the <em>client.c</em> and <em>server.c</em> from the online book. You should be able to use this code in any Windows development environment; I have tested this using Microsoft Visual Studio Community Edition 2019 with support to build desktop C/C++ applications. You can make a new project for each program, one project for the server and one project for the client, using a <em>“Console App”</em> template; you will need to create a “.c” file and delete the “.cpp” file that is provided by default.</p>
<p>You should be able to build each project and you can try running the program in debug mode, however, remember that you will need a command-line argument for WinServer.c. I did not debug these programs in Visual Studio, instead I used the Windows Command Prompt to find and run each program.</p>
<p>To use the Windows Command Prompt, first type <em>“cmd”</em> in the search bar or click Start-&gt;Run then enter <em>“cmd”</em> in the prompt. Once you run <em>“cmd”</em>, you will need to navigate to the debug folder of your project. By default, the Command Prompt's current working directory will be in <code>C:\Users\YourNameHere</code>. Your Visual Studio projects are typically found within <code>C:\Users\YourNameHere\source\repos</code>. You can use the <code>cd</code> command (change directories command; this is the same as Linux/Unix) to go to this folder; e.g., “<code>cd source\repos</code>”. You can use the <code>dir</code> command (display a directory’s files and subdirectories; this is similar to the Unix/Linux <code>ls</code> command) to view the files within the current working directory. You will then want to navigate to the debug folder of the project you want to run; e.g., “<code>cd ProjectName\Debug</code>”. Remember that “<code>cd ..</code>” can be used to go back one directory (or go up one level in the directory tree).</p>
<h3 id="running-the-server-run-this-first-1">Running the Server (run this first)</h3>
<p>Prior to running the server, I recommend that you determine the IP address of your PC. You can use the command “<code>ipconfig /all</code>” to view information about your network interfaces. Find the network interface you are using and then you should see your IPv4 (IP version 4) address; remember to use this address for your client. Now, go to the directory where your executable is located and run it; e.g., “<code>WinServer.exe</code>”. This program will wait until strings are sent to it from a client, then it will print the strings to the screen. Use <em>Control-C</em> to exit the program.</p>
<h3 id="running-the-client-1">Running the Client</h3>
<p>First, determine the IP address of the server you wish to connect to; see <em>“Running the Server”</em> above. Go to the directory where your executable is located and run it with the IP address of the server you wish to connect to as a command-line argument; e.g., “<code>WinClient.exe 192.168.1.25</code>”. Then enter strings of text followed by an enter/return; each string will be printed by the server. Use <em>Control-C</em> to exit the program.</p>
